{"version":3,"sources":["App.tsx"],"names":["ai","OpenAIApi","Configuration","apiKey","App","useState","messages","setMessages","isTyping","setTyping","useEffect","isUnmounted","a","async","AsyncStorage","getItem","data","json","JSON","parse","console","log","length","_id","text","createdAt","Date","user","name","avatar","catch","err","error","setItem","stringify","newCompletion","incommings","message","createCompletion","prompt","max_tokens","temperature","top_p","frequency_penalty","presence_penalty","completion","choices","trim","previousMessages","GiftedChat","append","String","Math","random","substr","response","status","onSend","useCallback","style","flex","backgroundColor","showUserAvatar","showAvatarForEveryMessage","renderUsernameOnMessage","Platform","OS","behavior"],"mappings":"mOAQMA,EAAK,IAAIC,YAAU,IAAIC,gBAAc,CAACC,OAAQ,yDAErC,SAASC,IACtB,MAA+BC,mBAAqB,IAApD,WAAOC,EAAP,KAAgBC,EAAhB,KACA,EAA6BF,oBAAkB,GAA/C,WAAOG,EAAP,KAAgBC,EAAhB,KAEAC,qBAAU,WACR,IAAIC,GAAc,EAsBlB,OArBA,WAAC,iBAAAC,EAAAC,OAAA,oDACKF,EADL,mEAAAC,EAAA,MAEoBE,IAAaC,QAAQ,cAFzC,OAEOC,EAFP,OAGOC,EAAOC,KAAKC,MAAMH,GAAM,MAE9BI,QAAQC,IAAI,mBAAoBL,GAC5BC,EAAKK,OACPf,EAAYU,GAEZV,EAAY,CAAC,CACXgB,IAAI,IACJC,KAAK,gBACLC,UAAW,IAAIC,KACfC,KAAM,CACJJ,IAAI,IACJK,KAAK,SACLC,OAAO,wCAhBd,4DAAD,GAoBKC,OAAM,SAAAC,GAAG,OAAIX,QAAQY,MAAMD,MACzB,WAAQpB,GAAc,KAC7B,IAEFD,qBAAU,WAMR,OAJC,EAAAE,EAAAC,OAAA,uDACCO,QAAQC,IAAI,mBAAoBf,GADjC,WAAAM,EAAA,MAEOE,IAAamB,QAAQ,YAAaf,KAAKgB,UAAU5B,KAFxD,4DAGIwB,OAAM,SAAAC,GAAG,OAAIX,QAAQY,MAAMD,MACzB,YAAsB,KAC7B,CAACzB,IAEH,IAAM6B,EAAgB,SAAOC,GAAP,mBAAAxB,EAAAC,OAAA,uDACpBJ,GAAU,GACJ4B,EAAUD,EAAW,GAFP,oBAAAxB,EAAA,MAIOZ,EAAGsC,iBAAiB,eAAgB,CAC3DC,OAAQF,EAAQb,KAChBgB,WAAY,GACZC,YAAa,GACbC,MAAM,GACNC,kBAAkB,GAClBC,iBAAiB,EACjBjB,KAAK,OAXW,OAIZkB,EAJY,OAclBzB,QAAQC,IAAI,gBAAZ,SAA6BwB,EAAW7B,KAAK8B,QAAQ,GAAGtB,WAAxD,EAA6B,EAAiCuB,QAE9DxC,GAAY,SAAAyC,GAAgB,OAAIC,IAAWC,OAAOF,EAAmB,CAAC,CACpEzB,IAAK4B,OAAOC,KAAKC,SAAWD,KAAKC,UAAUC,OAAO,GAClD9B,KAAMqB,EAAW7B,KAAK8B,QAAQ,GAAGtB,KACjCC,UAAW,IAAIC,KACfC,KAAM,CACJJ,IAAI,IACJK,KAAK,UACLC,OAAO,2CAvBO,kDA4Bd,KAAE0B,SACJnC,QAAQY,MAAM,gBAAiB,KAAEuB,SAASC,OAAQ,KAAED,SAASvC,MAE7DI,QAAQY,MAAM,gBAAiB,KAAEK,SA/BjB,yBAkClB5B,GAAU,GAlCQ,qFAsChBgD,EAASC,uBAAY,WAAoB,IAAnBpD,EAAkB,uDAAP,GACpC,EAAAM,EAAAC,OAAA,uDACCO,QAAQC,IAAI,SAAUH,KAAKgB,UAAU5B,IACrCC,GAAY,SAAAyC,GAAgB,OAAIC,IAAWC,OAAOF,EAAmB1C,MAFtE,WAAAM,EAAA,MAGOuB,EAAc7B,IAHrB,8DAKA,IAEH,OACE,eAAC,IAAD,CAAMqD,MAAO,CAAEC,KAAM,EAAGC,gBAAiB,QAAzC,UACE,cAAC,IAAD,CAAYvD,SAAUA,EACVE,SAAUA,EACViD,OAAQ,SAAAnD,GAAQ,OAAImD,EAAOnD,IAC3BqB,KAAM,CAAEJ,IAAI,IAAKK,KAAK,KAAMC,OAAO,uCACnCiC,gBAAgB,EAChBC,2BAA2B,EAC3BC,yBAAyB,IAEnB,YAAhBC,IAASC,IACX,cAAC,IAAD,CAAsBC,SAAS,YAE/B,cAAC,IAAD,CAAWR,MAAM,c","file":"static/js/app.502b4dcb.chunk.js","sourcesContent":["import { StatusBar } from 'expo-status-bar';\nimport { StyleSheet, Text, View, KeyboardAvoidingView, Platform, Dimensions } from 'react-native';\nimport React, { useState, useCallback, useEffect } from 'react';\nimport { GiftedChat, IMessage } from 'react-native-gifted-chat';\nimport AsyncStorage from '@react-native-async-storage/async-storage';\nimport { Configuration, OpenAIApi } from \"openai\"\nimport { useAsyncEffect } from './hooks/useAsyncEffect';\n\nconst ai = new OpenAIApi(new Configuration({apiKey: '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'}));\n\nexport default function App() {\n  const [messages,setMessages] = useState<IMessage[]>([]);\n  const [isTyping,setTyping] = useState<boolean>(true);\n\n  useEffect(() => {\n    let isUnmounted = false;\n    (async () => {\n      if (isUnmounted) return;\n      const data = await AsyncStorage.getItem('@messages');\n      const json = JSON.parse(data||'[]');\n\n      console.log('useEffect:reload', data);\n      if (json.length) {\n        setMessages(json);\n      } else {\n        setMessages([{\n          _id:'1',\n          text:'Let\\'s  begin!',\n          createdAt: new Date,\n          user: {\n            _id:'2',\n            name:'OpenAI',\n            avatar:'https://placeimg.com/140/140/tech',\n          },\n        },]);\n      }\n    })().catch(err => console.error(err));\n    return () => { isUnmounted = true; }\n  },[]);\n\n  useEffect(() => {\n    let isUnmounted = false;\n    (async () => {\n      console.log('useEffect:update', messages);\n      await AsyncStorage.setItem('@messages', JSON.stringify(messages));\n    })().catch(err => console.error(err));\n    return () => { isUnmounted = true; }\n  },[messages])\n \n  const newCompletion = async (incommings : IMessage[]) => {\n    setTyping(true);\n    const message = incommings[0];\n    try {\n      const completion = await ai.createCompletion('text-ada-001', {\n        prompt: message.text,        // text\n        max_tokens: 24,    \n        temperature: 0.9, // more risky responses\n        top_p:0.3,\n        frequency_penalty:0.5,\n        presence_penalty:0.0,\n        user:'1',\n      });\n\n      console.log('newCompletion', completion.data.choices[0].text?.trim());\n\n      setMessages(previousMessages => GiftedChat.append(previousMessages , [{\n        _id: String(Math.random() * Math.random()).substr(2),\n        text: completion.data.choices[0].text,\n        createdAt: new Date,\n        user: {\n          _id:'2',\n          name:'Kayleen',\n          avatar:'https://placeimg.com/140/140/tech', \n        },\n      }]));\n\n    } catch (e) {\n      if (e.response) {\n        console.error('newCompletion', e.response.status, e.response.data);\n      } else {\n        console.error('newCompletion', e.message);\n      }\n    } finally {\n      setTyping(false);\n    }\n  };\n\n  const onSend = useCallback((messages = []) => {\n    (async () => {\n      console.log('onSend', JSON.stringify(messages));\n      setMessages(previousMessages => GiftedChat.append(previousMessages , messages));\n      await newCompletion(messages);\n    })()\n  }, []);\n\n  return (\n    <View style={{ flex: 1, backgroundColor: '#fff', }}>\n      <GiftedChat messages={messages}\n                  isTyping={isTyping}\n                  onSend={messages => onSend(messages)}\n                  user={{ _id:'1', name:'Me', avatar:'https://placeimg.com/140/140/people', }}\n                  showUserAvatar={true}\n                  showAvatarForEveryMessage={true}\n                  renderUsernameOnMessage={true}/>\n\n      { Platform.OS === 'android' && \n      <KeyboardAvoidingView behavior=\"padding\" /> }\n\n      <StatusBar style=\"auto\" />\n    </View>\n  );\n};"],"sourceRoot":""}